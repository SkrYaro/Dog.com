{% extends "based/base.html" %}
{% load crispy_forms_tags %}
{% block content %}

<div class="container my-4">
  <div class="row">
    <div class="col-lg-9">

      <!-- –ù–∞–∑–≤–∞ –ø–æ—Å—Ç–∞ -->
      <h1 class="mb-4">{{ post.name }}</h1>

      <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å—Ç–∞ -->
      <div class="mb-4 text-center">
        {% if post.postType == "video" %}
          <video class="img-fluid rounded" src="{{ post.video.url }}" controls></video>
        {% elif post.postType == "img" %}
          <img class="img-fluid rounded" src="{{ post.img.url }}" alt="image">
        {% else %}
          <p class="fst-italic">{{ post.react }}</p>
        {% endif %}
      </div>

      <!-- Accordion –æ–ø–∏—Å -->
      <div class="accordion mb-4" id="accordionExample">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
              –û–ø–∏—Å
            </button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
               data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <p class="mb-2">
                –ê–≤—Ç–æ—Ä: <a href="{% url 'profile' post.author.id %}">{{ post.author }}</a>
              </p>
              <div class="card">
                <div class="card-body">{{ post.description }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è -->
      <div class="card mb-4">
        <div class="card-body">
          <form action="{% url 'commentAdd' post.id %}" method="POST">
            {% csrf_token %}
            {{ form|crispy }}
            <button type="submit" class="btn btn-primary mt-2">üí¨ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</button>
          </form>
        </div>
      </div>

      <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ -->
      <h4 class="mb-3">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ:</h4>
      {% for comment in comments %}
        <div class="card mb-3 shadow-sm">
          <div class="card-body">
            <h6 class="card-title">{{ comment.author }}</h6>
            <a class="text-decoration-none" data-bs-toggle="collapse" href="#comment{{ comment.id }}"
               aria-expanded="false" aria-controls="comment{{ comment.id }}">
              {{ comment.text }}
            </a>
          </div>
        </div>

        <!-- –í—ñ–¥–ø–æ–≤—ñ–¥—ñ -->
        <div class="collapse" id="comment{{ comment.id }}">
          <div class="card card-body mb-2">
            <form class="mb-2" action="{% url 'answerCommentAdd' post.id comment.id %}" method="POST">
              {% csrf_token %}
              {{ form|crispy }}
              <button type="submit" class="btn btn-sm btn-success mt-1">‚Ü© –í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏</button>
            </form>

            {% for answer in comment.answer.all %}
              <div class="border rounded p-2 mb-2 bg-light">
                <b>{{ answer.author }}:</b> {{ answer.text }}
              </div>
            {% empty %}
              <div class="text-muted fst-italic">–ü–æ–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –Ω–µ–º–∞—î</div>
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- –ü—Ä–∞–≤–∞ –∫–æ–ª–æ–Ω–∫–∞ (–º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –¥–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó) -->
    <div class="col-lg-3">
      <!-- –ú—ñ—Å—Ü–µ –ø—ñ–¥ –≤—ñ–¥–∂–µ—Ç–∏/—Ä–µ–∫–ª–∞–º—É/—ñ–Ω—à—ñ –±–ª–æ–∫–∏ -->
    </div>
  </div>
</div>

{% endblock %}
