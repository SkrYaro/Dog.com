{% extends "based/base.html" %}
{% load crispy_forms_tags %}
{% block content %}

<div class="container my-4">
  <div class="row">
    <div class="col-lg-9">

      <!-- –ù–∞–∑–≤–∞ –ø–æ—Å—Ç–∞ -->
      <h1 class="mb-4">{{ post.name }}</h1>

      <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å—Ç–∞ -->
      <div class="mb-4 text-center">
        {% if post.postType == "video" %}
          <video controls class="img-fluid rounded" preload="metadata" playsinline src="{{ post.video.url }}"></video>
        {% elif post.postType == "img" %}
          <img class="img-fluid rounded" src="{{ post.img.url }}" alt="image">
        {% else %}
          <!-- –•–º–∞—Ä–∫–∞ –¥–ª—è react -->
          <div class="card shadow-sm border-info mx-auto" style="max-width:600px;">
            <div class="card-body text-start bg-light">
              <h5 class="fw-bold text-info">üí° React</h5>
              <p class="fst-italic mb-0">{{ post.react }}</p>
            </div>
          </div>
        {% endif %}
      </div>

      <!-- Accordion –æ–ø–∏—Å -->
      <div class="accordion mb-4" id="accordionExample">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
              –û–ø–∏—Å
            </button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
               data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <p class="mb-2">
                –ê–≤—Ç–æ—Ä: <a href="{% url 'profile' post.author.id %}">{{ post.author }}</a>
              </p>
              <div class="card">
                <div class="card-body">{{ post.description }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
 {%if request.user.is_authenticated%}
      <!-- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ –∫–Ω–æ–ø–∫–∞–º–∏ -->
      <div class="mb-4">
        {% if rating %}
          <h5 class="fw-bold">‚≠ê –°–µ—Ä–µ–¥–Ω—è –æ—Ü—ñ–Ω–∫–∞: <span class="text-warning">{{ rating }}</span></h5>
        {% else %}
          <h5 class="fw-bold">‚≠ê –°–µ—Ä–µ–¥–Ω—è –æ—Ü—ñ–Ω–∫–∞: <span class="text-warning">–ù–µ–º–∞—î –æ—Ü—ñ–Ω–æ–∫</span></h5>
        {% endif %}

        {% if rate %}
          <h5>–í–∏ –ø–æ—Å—Ç–∞–≤–∏–ª–∏: <b class="text-warning">{{ rate.rating }}</b></h5>
        {% else %}
          <h5>–í–∏ –ø–æ—Å—Ç–∞–≤–∏–ª–∏: <b class="text-warning">–ü–æ–∫–∏ –Ω—ñ—á–æ–≥–æ</b></h5>
        {% endif %}

        <div class="d-flex gap-2 mt-2 flex-wrap">
          <a href="{% url 'rate' post.id 1 %}" class="btn btn-outline-warning">1 ‚≠ê</a>
          <a href="{% url 'rate' post.id 2 %}" class="btn btn-outline-warning">2 ‚≠ê</a>
          <a href="{% url 'rate' post.id 3 %}" class="btn btn-outline-warning">3 ‚≠ê</a>
          <a href="{% url 'rate' post.id 4 %}" class="btn btn-outline-warning">4 ‚≠ê</a>
          <a href="{% url 'rate' post.id 5 %}" class="btn btn-outline-warning">5 ‚≠ê</a>
          <a href="{% url 'delRate' post.id %}" class="btn btn-outline-danger">–í—ñ–¥–º—ñ–Ω–∏—Ç–∏ –æ—Ü—ñ–Ω–∫—É</a>
        </div>
      </div>

      <!-- –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è -->
      <div class="card mb-4">
        <div class="card-body">
          <form action="{% url 'commentAdd' post.id %}" method="POST">
            {% csrf_token %}
            {{ form|crispy }}
            <button type="submit" class="btn btn-primary mt-2">üí¨ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</button>
          </form>
        </div>
      </div>
{%endif%}
      <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ -->
      <h4 class="mb-3">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ:</h4>
      {% for comment in comments %}
        <div class="card mb-3 shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="card-title mb-1">{{ comment.author }}</h6>
                <p class="card-text">{{ comment.text }}</p>

                <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–∫–∞–∑—É –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π -->
                <button class="btn btn-sm btn-outline-secondary"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#comment{{ comment.id }}">
                  ‚Ü© –í—ñ–¥–ø–æ–≤—ñ–¥—ñ
                </button>
              </div>
              {% if request.user == comment.author.user or request.user == post.author.user or request.user.is_staff %}
                <a href="{% url 'comDel' post.id comment.id %}" class="btn btn-sm btn-outline-danger">
                  –í–∏–¥–∞–ª–∏—Ç–∏
                </a>
              {% endif %}
            </div>
          </div>
        </div>
       <div class="collapse" id="comment{{ comment.id }}">
                        {%if request.user.is_authenticated%}

        <!-- –ë–ª–æ–∫ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π -->

          <div class="card card-body mb-2 bg-light">
            <form class="mb-2" action="{% url 'answerCommentAdd' post.id comment.id %}" method="POST">
              {% csrf_token %}
              {{ form|crispy }}
              <button type="submit" class="btn btn-sm btn-success mt-1">‚Ü© –í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏</button>
            </form>
{%endif%}
            {% for answer in comment.answer.all %}
              <div class="border rounded p-2 mb-2 bg-white shadow-sm">
                <b>{{ answer.author }}:</b> {{ answer.text }}
              </div>
            {% empty %}
              <div class="text-muted fst-italic">–ü–æ–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –Ω–µ–º–∞—î</div>
            {% endfor %}
          </div>
        </div>
      {% endfor %}

    </div>
  </div>
</div>

{% endblock %}
